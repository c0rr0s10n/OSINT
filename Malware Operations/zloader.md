# Zloader Introduction
Zloader, also known as Terdot and Zbot is a banking trojan. It uses webinjects to steal passwords and auth codes of its victims. The trojan was first spotted in 2016 but it has seen a sudden surge of activity in the winter of 2019, appearing in over 100 email campaigns. Zloader is constructed using the leaked code of the well-known ZeuS malware. ZeuS code was made public in 2011 and became a base for various malware samples. The fact that its variants are still being used goes to show how effective the original malware was.

# MDATP Advanced Hunting Queries
<details>
<summary>Hunting for ZLoader activity using known indicators</summary>
<p>
    
```
// Hunting for malware operations using known Zloader indicators (as of September 2020)
search in (DeviceFileEvents, DeviceProcessEvents, DeviceEvents, DeviceRegistryEvents, DeviceNetworkEvents, DeviceImageLoadEvents, DeviceLogonEvents)
    Timestamp > ago (7d)
    and 
        (
            (
                (RemoteUrl has "/downloads/#" or 
                ProcessCommandLine has "/downloads/#")
            and (RemoteUrl matches regex "https?://[^/]+/downloads/#[A-Za-z0-9_]{22}" or 
                ProcessCommandLine matches regex ".https?://[^/]+/downloads/#[A-Za-z0-9_]{22}\"")
            )
        or (
            ProcessCommandLine has ",DllRegisterServer" and ProcessCommandLine has "\\Temp\\"
        )
        or (
            (FolderPath matches regex "Temp1_[a-zA-Z0-9_]{12}.zip" and FolderPath matches regex "[a-zA-Z0-9_]{12}.vbs") or 
            (InitiatingProcessCommandLine matches regex "Temp1_[a-zA-Z0-9_]{12}.zip" and InitiatingProcessCommandLine matches regex "[a-zA-Z0-9_]{12}.vbs")
        )
        )
| sort by Timestamp
```
</p>
</details>

# YARA Rule (Delivery Detection)
<details>
<summary>Email Hunting in Cofense</summary>
<p>
    
```YARA
meta:
  rule_context="Internal Safe"
strings: 
  $byte0={24 22 23 2c 23 23 30 5f 29 3b 5c 28 22 24 22 23 2c 23 23 30 5c 29 1e 04 21 00 06 00 1c 00 00 22 24 22 23 2c 23 23 30 5f 29 3b 5b 52 65 64 5d 5c 28 22 24 22 23 2c 23 23 30 5c 29}
  $byte1={00 57 61 72 6e 69 6e 67 20 54 65 78 74}
  $header0="header.from=aol.com;" nocase
  $header1="header.from=gmail.com;" nocase
  $header2="header.from=mail.com;" nocase
condition:
  1 of ($byte*) and 1 of ($header*)
```
</p>
</details>

# Zloader In-Depth Historical
Researchers first observed Zloader, also known at the time as DELoader, in 2016, when it started attacking Canadian banking organizations. The malware’s name highlights two facts: the letter “Z” shows that it is based on the Zeus Banking Trojan and the word “loader” highlights the malware’s unique design. Zloader makes its way into the machines of the victims using a loader which installs the final payload. Zloader became quite popular and served as the main tool for several hackers, with TA511 also known as Hancitor being the most acknowledged. After working with Zloader for almost 2 years, Hancitor made a jump to Panda Banker. Others soon followed suit and Zloader became abandoned until 2019, when researchers detected a sudden surge of attacks. Possibly, attackers pursued the opportunity presented with the confusion that surrounds the COVID crisis, launching a new wave of campaigns in December 2019, with the number of sightings only increasing by March 2020. 

Although, previously Zloader focused on finding victims in Canada, starting with 2020 it expanded the geography of operations. The newer campaigns attack financial institutions all over the world, including the US, Australia, and Europe. The malware uses a technique called web injects to trick victims into revealing their authentication codes. Zloader replaces the banking website of the victim with an identical copy fetched from a custom file so that unsuspecting users give away credentials thinking that they are logging into their bank. In reality, the sensitive information, including auth codes, is sent to the C&C controlled by the attackers. Additionally, Zloader can fetch information from browsers, accessing cookies and passwords — a standard functionality for banking trojans. Interestingly, the 2019 version of Zloader is less advanced than its predecessor, seen in 2016. Researchers think that it might be a revision of an older iteration of the malware that lacked some of the sophisticated malicious techniques. Among the missing features are code obfuscation and string encryption — those are both techniques threat actors use to complicated static analysis of malware by making the code unreadable. However, that does not mean that Zloader should be taken lightly. It's still a top-level malware and it is highly dangerous.

For example, if attackers manage to get a hold of the credentials, they use a smart technique to log into the account without raising red flags with the bank. The threat actors log in with a virtual network computing client, so all the bank sees is another session from the normal victim’s machine. This way, not only can attackers withdraw money without raising any alarms but proving that the transaction fraudulence is also difficult. On top of that, the malware still uses some anti-evasion techniques like Command & Control blacklisting and Windows API function hashing, making the analysis more complicated. Another worrying sign is the constant maintenance of Zloader. No less than 18 versions have been seen circulating in the wild from January to March 2020. The malware is being constantly improved.

# Zloader Behaviorals, TTPs & IOCs
Zloader usually makes its way into systems as an executable or as a script file. When entering as a script file, it runs and compiles into the library by wscript process. As an executable file, the malware makes an injection into msiexec.exe process. After that Zloader tries to connect to Command & Control server over HTTPS to download additional modules.

Zloader is distributed to victims with malspam. Emails are crafted to look like government notices or financial support offered due to the COVID-19 epidemic. Attached to emails are malicious files, normally with Microsoft Office file extensions, but PDF files were also observed. When opened, the files ask the victim to enable macros. If users compile, the macros download a loader which establishes a connection with the command and control server and installs the final payload — Zloader.

Zloader creates registry keys with pseudo-random names under HKEY_CURRENT_USER\Software\Microsoft and directories with pseudo-random names inside the %APPDATA% directory. This activity can help analysts detect this malware family.

* Any.Run demo -> https://app.any.run/tasks/7a680751-33ef-422a-a1a0-33f3d1a83230/
* Any.Run submissions -> https://app.any.run/submissions/#tag:zloader
* URLhaus submissions -> https://urlhaus.abuse.ch/browse/tag/zloader/
